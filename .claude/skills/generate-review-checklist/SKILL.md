---
name: generate-review-checklist
description: 実装済みコードのレビューチェックリストを自動生成するコマンド
---

# Generate Review Checklist Command

実装済みのコードを分析し、開発者が理解度を確認するためのチェックリストを自動生成するコマンドです。

**2つの入力ソースを組み合わせて生成:**
1. **ステアリングドキュメント**: `docs/steering/{feature}/` から要件・設計意図を取得
2. **コード差分**: PR または現在のブランチ差分から実際の変更内容を取得

---

## 出力ファイル

```
docs/steering/{YYYYMMDD}-{feature-name}/
└── code-review-checklist.md   # レビューチェックリスト
```

---

## 実行フロー

```
Step 1: コード差分の取得（PR or ブランチ差分）
Step 2: ステアリングドキュメントの特定・読み込み
Step 3: 両方の情報を統合してチェックリスト生成
Step 4: ファイル保存
```

---

## Step 1: コード差分の取得

### 1.1 PR の確認

現在のブランチに関連する PR があるか確認:

```bash
gh pr list --head $(git branch --show-current) --json number,title,state
```

### 1.2 差分取得

**PR がある場合:**
```bash
gh pr view {PR_NUMBER} --json title,body,files,additions,deletions
gh pr diff {PR_NUMBER}
```

**PR がない場合（ブランチ差分）:**
```bash
git diff main...HEAD --name-status
git diff main...HEAD
```

### 1.3 変更ファイル分析

差分を分析:
- 追加ファイル
- 変更ファイル
- 削除ファイル
- 変更行数

---

## Step 2: ステアリングドキュメントの特定

### 2.1 自動特定

ブランチ名からステアリングディレクトリを推測:

```
ブランチ名: modify/20260116-timezone-reset
  ↓
ステアリング: docs/steering/20260116-modify-timezone-reset/
```

### 2.2 手動選択（自動特定できない場合）

```
ステアリングドキュメントを選択してください:

{docs/steering/ 配下のディレクトリ一覧を表示}
```

### 2.3 ドキュメント読み込み

以下のファイルを読み込む（存在する場合）:
- `requirements.md` または `change-request.md` - 要件定義
- `design.md` - 技術設計
- `tasklist.md` - 実装タスク
- `impact-analysis.md` - 影響分析

---

## Step 3: チェックリスト生成

### 3.1 情報の統合

| 情報源 | 取得内容 |
|--------|----------|
| ステアリングドキュメント | 要件の意図、設計判断の理由、注意点 |
| コード差分 | 実際の変更内容、変更されたファイル・関数 |

### 3.2 Phase構造

変更の性質に応じてPhaseを構成:

| 変更タイプ | Phase |
|-----------|-------|
| DB/スキーマ変更 | Phase 1: 基盤層 |
| ユーティリティ関数 | Phase 1: 基盤層 |
| API Routes | Phase 2: バックエンド |
| コンポーネント | Phase 3: フロントエンド |
| ページ | Phase 3: フロントエンド |
| 型定義 | 関連するPhaseに含める |
| 翻訳ファイル | Phase 4: 翻訳・その他 |
| テストファイル | Phase 4: テスト |

### 3.3 チェック項目の粒度

各ファイルに対して:
- **関数/コンポーネント単位**: 主要なロジックごとにチェック項目
- **理解確認質問**: 重要なロジックには Q&A 形式の確認を追加
- **依存関係**: 他ファイルとの連携ポイントを明記

### 3.4 重要度マーク

特に重要な項目には `★重要` マークを付与:
- セキュリティに関わるロジック
- ビジネスロジックの核心部分
- 複雑な条件分岐

### 3.5 アーキテクチャ理解セクション

最終確認として以下を含める:
- データの流れ（図またはテキスト）
- セキュリティ考慮点
- 後方互換性

---

## Step 4: ファイル保存

テンプレート（`.claude/skills/generate-review-checklist/templates/checklist-template.md`）を使用してチェックリストを生成・保存。

---

## 完了時の出力

```
チェックリストを生成しました！

📄 **ファイル**: `docs/steering/{YYYYMMDD}-{feature-name}/code-review-checklist.md`

**入力ソース**:
- ステアリング: docs/steering/{feature}/
- PR: #{PR番号} または ブランチ差分

**サマリー**:
- Phase数: {N}
- チェック項目数: {M}
- 理解確認質問数: {L}

---

このチェックリストを使って、実装の理解度を確認してください。
すべての項目にチェックが入れば、実装全体を理解したことになります。
```

---

## 注意事項

- チェックリストは「レビュー」ではなく「理解確認」のためのガイド
- ステアリングドキュメントから「なぜこの実装か」の背景を含める
- コード差分から「何が変わったか」の詳細を含める
- 自動生成後、手動で調整・追記することを推奨
- 翻訳ファイルは言語数をカウントして「N言語」と表記
- テストファイルがある場合は、テストケースの一覧を含める
